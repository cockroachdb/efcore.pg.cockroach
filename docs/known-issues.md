### CockroachDB doesn't support renaming a table that doesn't have primary key

This is a known limitation of CockroachDB. This issue impacts code first migration when a table is remapped to a new table name.

By default, EF Core will generate a set of SQL commands to
drop the PK constraint
rename the table, and
re-add the PK constraint

The workaround is to edit the migration code generated by EF Core to make it work with CockroachDB.

Github issues: https://github.com/cockroachdb/cockroach/issues/112090


### CockroachDB doesn’t support the function pg_terminate_backend(). EnsureDeleted and EnsureDeletedAsync do not work.

This code

```csharp
await using var ctx = new BlogContext();
await ctx.Database.EnsureDeletedAsync();
await ctx.Database.EnsureCreatedAsync();
```

### CockroachDB doesn't support concurrency token column
Github issue: https://github.com/cockroachdb/cockroach/issues/33296

Entity Framework Core supports the concept of optimistic concurrency - a property on your entity is designated as a concurrency token, and EF Core detects concurrent modifications by checking whether that token has changed since the entity was read.

In PostgreSQL, the xmin column, which xmin holds the ID of the latest updating transaction, can be used as concurrency token column.

### CockroachDB doesn’t support such a column.

This code will not work as with PostgreSQL or other databases

```csharp
class MyContext : DbContext
{
    public DbSet<SomeEntity> SomeEntities { get; set; }

    protected override void OnModelCreating(ModelBuilder modelBuilder)
    {
        modelBuilder.Entity<SomeEntity>()
            .Property(b => b.Version)
            .IsRowVersion();
    }
}
```

### CockroachDB doesn't support date range types
Github issue: https://github.com/cockroachdb/cockroach/issues/27791

This code will not work

```csharp
public class Entity
{
        public NpgsqlRange<DateTime> TimestamptzDateTimeRange { get; set; }
       
        [Column(TypeName = "tsrange")]
        public NpgsqlRange<DateTime> TimestampDateTimeRange { get; set; }
}
```

### CockroachDB uses 64-bit signed integers for INT by default
efcore.pg follows PostgreSQL default where 32-bit integers are used.

Workaround: Change the cluster setting default_int_size to 4

SET CLUSTER SETTING sql.defaults.default_int_size = 4;

CockroachDB uses rowid for SERIAL column by default
This conflicts with how efcore.pg handles SERIAL columns

Workaround: Change the cluster setting serial_normalization to use sql_sequence, similar to PostgreSQL

### CockroachDB doesn't support renaming a table that doesn't have primary key
Github issue: https://github.com/cockroachdb/cockroach/issues/112090

This is a known limitation of CockroachDB. This issue impacts code first migration when a table is remapped to a new table name. 

By default, EF Core will generate a set of SQL commands to 
drop the PK constraint
rename the table, and
re-add the PK constraint

The workaround is to edit the migration code generated by EF Core to make it work with CockroachDB.

### CockroachDB doesn’t support the function pg_terminate_backend(). EnsureDeleted and EnsureDeletedAsync do not work.
Github issue: https://github.com/cockroachdb/cockroach/issues/35897 

This code will throw error

await using var ctx = new BlogContext();
await ctx.Database.EnsureDeletedAsync();

### CockroachDB doesn't support function that returns TABLE
Github issue: https://github.com/cockroachdb/cockroach/issues/100226 

### CockroachDB doesn't support make_date, make_timestamp, make_timestamptz
Github issue: https://github.com/cockroachdb/cockroach/issues/108448 

These functions are supported in latest 23.1 build

### CockroachDB doesn't support CREATE COLLATION, DROP COLLATION
Github issue: https://github.com/cockroachdb/cockroach/issues/59567

This is a known limitation of CockroachDB. EFCore supports for creating collation will not work.

### CockroachDB doesn’t support ADD GENERATED, SET GENERATED in ALTER COLUMN
Github issue: https://github.com/cockroachdb/cockroach/issues/110010 

This impacts code first migration when the following extension methods are used to add or set an existing column as identity column

UseIdentityAlwaysColumn
UseIdentityByDefaultColumn

### CockroachDB doesn't support creating indexes with operators
Github issue: https://github.com/cockroachdb/cockroach/issues/110247

This impacts code first migration when the extension method HasOperator is used to create index

For example:
```csharp
builder => builder.Entity("People").HasIndex("FirstName", "LastName")
                .HasOperators("text_pattern_ops")
```

### CockroachDB doesn’t support RESTART WITH, SET INCREMENT BY in ALTER COLUMN
Github issue: https://github.com/cockroachdb/cockroach/issues/110015 

This impacts code first migration when the extension method HasIdentityOptions is used to update the options for an identity column 

For example:

modelBuilder.Entity<Blog>().Property(b => b.Id).HasIdentityOptions(startValue: 100, incrementBy: 2)

### CockroachDB doesn’t support CYCLE option for sequences
Github issue: https://github.com/cockroachdb/cockroach/issues/20961 

In PostgreSQL, The CYCLE option allows the sequence to wrap around when the maxvalue or minvalue has been reached by an ascending or descending sequence respectively. If the limit is reached, the next number generated will be the minvalue or maxvalue, respectively.

However, CockroachDB doesn’t support this option. Code that uses the extension method HasIdentityOptions to make a sequence cyclic will not work

Example:
```
builder => builder.Entity("People").Property<int?>("SomeColumn")
                .UseIdentityByDefaultColumn()
                .HasIdentityOptions(
                    startValue: 5,
                    incrementBy: 2,
                    minValue: 3,
                    maxValue: 2000,
                    cyclic: true,
                    numbersToCache: 10)
```

### CockroachDB doesn't truly support infinity
Github issue: https://github.com/cockroachdb/cockroach/issues/41564

PostgreSQL supports the special values -infinity and infinity for the timestamp and date types (see docs); these can be useful to represent a value which is earlier or later than any other value. Starting with Npgsql 6.0, these special values are mapped to the MinValue and MaxValue value on the corresponding .NET types (DateTime and DateOnly, NodaTime Instant and LocalDate). 

However, CockroachDB doesn’t support infinity values in the same way. 

The workaround is to disable conversions of infinity values to DateTime by setting the following AppContext switch at the start of your application:

AppContext.SetSwitch("Npgsql.DisableDateTimeInfinityConversions", true); 

### CockroachDB doesn't support array slicing
Github issue: https://github.com/cockroachdb/cockroach/issues/32551

CockroachDB doesn’t support dropping the foreign key constraint followed by dropping the referenced table within a transaction
Github issue: https://github.com/cockroachdb/cockroach/issues/108007

This is a limitation of CockroachDB

Workaround: Modify code in efcore.pg to suppress transaction on drop foreign key SQL command 

The default CockroachDB ordering is NULLs first for ascending order and NULLs last for descending order

efcore.pg follows PostgreSQL ordering while CockroachDB’s behavior is the opposite

Workaround: Modify code in efcore.pg

CockroachDB automatically creates rowid column when no primary key column is specified

This impacts code first migration in various scenarios

### CockroachDB doesn't return ErrorResponse if client sends a startup message with invalid database name
Github issue: https://github.com/cockroachdb/cockroach/issues/109992

Unsupported extensions
There are PostgreSQL extensions that are not supported by CockroachDB. Therefore, some corresponding functionalities provided by efcore.pg to support those extensions will not work properly with CockroachDB.

Examples: citext, brin, btree

### Inconsistent ordering in SQL queries generated for split query with Include

Github issue: https://github.com/dotnet/efcore/issues/31657

When EF Core is configured to use split query. Code that uses Include without explicit ordering as follow may not work correct
```
ss.Set<Customer>().Take(10).Include(c => c.Orders)
```

